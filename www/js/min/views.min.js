/* **********************************************
     Begin button.js
********************************************** *//* ---------------------------------------------------------------------------------------------------------
 
 	Header Buttons

 	* ButtonView 		- Wrapper for all butons elements within the header
 	* SingleButtonView 	- Individual button with different click events for each

 
---------------------------------------------------------------------------------------------------------*//********************************************************************************************************
	ButtonView
********************************************************************************************************/nzp.ButtonsView=Backbone.View.extend({tagName:"ul",className:"buttons",initialize:function(){_.bindAll(this,"render")},render:function(){_.each(this.model.attributes,function(e){var t=new nzp.SingleButtonView({model:e});this.$el.append(t.render().el)},this);return this}});nzp.SingleButtonView=Backbone.View.extend({tagName:"li",events:{"click a":"clicked"},initialize:function(){_.bindAll(this,"render")},clicked:function(e){e.preventDefault();switch(this.model.slug){case"home":console.log("home button clicked");break;case"menu":nzp.$body.toggleClass("active");break;case"back":nzp.router.navigate(nzp.router.previousPage,!0);nzp.$page.removeClass("map");nzp.$body.removeClass("showform");$(".tabbar").remove();break;case"scan":window.plugins.barcodeScanner.scan(function(e){e.cancelled?alert("the user cancelled the scan"):alert("we got a barcode: "+e.text)},function(e){alert("scanning failed: "+e)});break;default:nzp.router.navigate("",!0)}},render:function(){var e=_.template("<a href='#' class='<% print(classname); %>'><% print(title); %></a>"),t=e({classname:this.model.classname,title:this.model.title});this.$el.html(t);return this}});nzp.ContactPageView=Backbone.View.extend({el:'<div id="contact-page" class="page">',initialize:function(){_.bindAll(this,"render");this.render()},render:function(){var e="<p>My moneys in that office, right? If she start giving me some bullshit about it ain't there, and we got to go someplace else and get it, I'm gonna shoot you in the head then and there. Then I'm gonna shoot that bitch in the kneecaps, find out where my goddamn money is. She gonna tell me too. Hey, look at me when I'm talking to you, motherfucker. You listen: we go in there, and that nigga Winston or anybody else is in there, you the first motherfucker to get shot. You understand?</p>";this.$el.append(e)}});nzp.HeaderView=Backbone.View.extend({initialize:function(){_.bindAll(this,"render")},render:function(){nzp.headerTitle=new nzp.HeaderTitle;var e=new nzp.HeaderTitleView({model:nzp.headerTitle}),t=new nzp.Button(buttonsData),n=new nzp.ButtonsView({model:t});this.$el.append(e.render().el);this.$el.append(n.render().el);return this}});nzp.HeaderTitleView=Backbone.View.extend({tagName:"h1",initialize:function(){_.bindAll(this,"render","updateTitle");this.model.bind("change:title",this.updateTitle)},render:function(){this.$el.html(this.model.toJSON().title);return this},updateTitle:function(){this.$el.text(this.model.toJSON().title);return this}});nzp.LocatorPageView=Backbone.View.extend({el:'<div id="locator-page" class="page">',initialize:function(){this.template=_.template($("#tmp-locator").html());this.collection.bind("reset",this.render,this)},events:{click:"delegatedEvents"},delegatedEvents:function(e){e.preventDefault();var t=$(e.target);t.hasClass("refresh")&&this.pageRefresh();(t.hasClass("all-map")||t.parent().hasClass("all-map"))&&this.loadAllMap()},render:function(){$(this.el).html(this.template({}));$locationsList=$("#locator-list",this.el);_(this.collection.closestPlaces()).forEach(function(e){$locationsList.prepend((new nzp.LocatorItemView({model:e})).render().el)});return this},loadAllMap:function(e){nzp.router.navigate("locator/nearby/All",{trigger:!0})},pageRefresh:function(){nzp.router.locatorRefresh()}});nzp.LocatorItemView=Backbone.View.extend({tagName:"li",template:_.template($("#singleLocatorTemplate").html()),render:function(){$(this.el).html(this.template(this.model.attributes));return this},events:{"click a":"loadDetails"},loadDetails:function(e){e.preventDefault();nzp.router.navigate("locator/closest/"+this.model.id,{trigger:!0})}});nzp.LocatorDetailsSinglePage=Backbone.Model.extend({defaults:{apiKey:"a7f0c7b0b123012f06d2000c29b44ac0"},url:function(){return"http://api.nzpost.co.nz/locator/api/details/api_key="+this.get("apiKey")+"&id="+this.get("id")},parse:function(e){}});nzp.TrackingDetailsForm=Backbone.View.extend({el:'<form action="" id="tracking-add-name" class="tracking-form">',template:_.template($("#tmp-tracking-description-form").html()),initialize:function(){_.bindAll(this,"render")},events:{submit:"submitForm"},render:function(){this.$el.html(this.template({}));nzp.$packageName=this.$("#tracking-updated-name");return this},submitForm:function(e){var t=nzp.$packageName.val();if(t==""){this.model.save({user_added_name:""});return!1}this.model.save({user_added_name:t});nzp.$packageName.blur();nzp.$body.removeClass("showform")}});nzp.TrackingDetailsUserName=Backbone.View.extend({el:'<h2 id="user-added-name">',template:_.template($("#tmp-tracking-description-name").html()),initialize:function(){_.bindAll(this,"render");this.model.bind("change",this.update,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.model.toJSON().user_added_name.length===0&&this.$el.addClass("hide");return this},update:function(){var e=this;this.$el.html(this.template(this.model.toJSON()));if(this.model.toJSON().user_added_name.length>0){this.$el.addClass("highlight high-out");this.$el.removeClass("hide")}else this.$el.addClass("hide");setTimeout(function(){e.$el.removeClass("highlight high-out")},1e3);return this}});nzp.TrackingDetails=Backbone.View.extend({el:'<div id="tracking-details">',template:_.template($("#tmp-tracking-description-item").html()),events:{"click #tracking-delete":"deleteModel","click #tracking-edit":"showForm"},initialize:function(){_.bindAll(this,"render","deleteModel","showForm")},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},deleteModel:function(e){e.preventDefault();var t=confirm("Are you sure you want to delete "+this.model.track_code+"?");if(t){this.model.clear();nzp.router.navigate("tracking",{trigger:!0})}},showForm:function(e){e.preventDefault();console.log(nzp.$packageName);nzp.$body.toggleClass("showform");nzp.$packageName.focus()}});nzp.TrackingItemView=Backbone.View.extend({el:"<li>",template:_.template($("#tmp-tracking-item").html()),events:{"click a":"showDetails"},initialize:function(){this.model.bind("change",this.render,this)},render:function(){var e=this.template(this.model.toJSON());this.$el.html(e);$("a",this.$el).addClass(this.model.get("highlight"));return this},showDetails:function(e){e.preventDefault();var t=this.model.toJSON().track_code;nzp.router.navigate("tracking/"+t,{trigger:!0})}});var TrackingPageView=Backbone.View.extend({template:_.template($("#tmp-tracking").html()),el:'<ul id="tracking-list" class="list list-arrows">',initialize:function(){nzp.trackingPageCollection.bind("add",this.addOne,this);nzp.trackingPageCollection.bind("reset",this.render,this)},render:function(e){this.addAll();$trackingItem=this.$("#tracking-items");$("#tracking-page").append(this.$el);return this},addOne:function(e){console.log("add one");var t=new nzp.TrackingItemView({model:e});this.$el.prepend(t.render().el)},addAll:function(){$(this.el).html("");nzp.trackingPageCollection.each(function(e){var t=new nzp.TrackingItemView({model:e});this.$el.append(t.render().el)},this)}});nzp.TrackingFormView=Backbone.View.extend({template:_.template($("#tmp-tracking").html()),initialize:function(){_.bindAll(this,"render")},events:{"click #tracking-submit":"getPackage"},render:function(){this.$el.html(this.template({}));$trackingNo=this.$("#tracking-number");return this},getPackage:function(e){e.preventDefault();var t=this;if($trackingNo.val()!=""){var n=$trackingNo.val(),r;this.collection.each(function(e){if(e.get("track_code")===n){r=e;console.log(r);e.set("highlight","highlight high-out");setTimeout(function(){e.set("highlight","high-out")},1e3)}});if(!IsObject(r)){var i=nzp.trackingPageCollection.create({track_code:n});$.ajax({dataType:"jsonp",url:i.url(),success:function(e){console.log(e);var t=n.toUpperCase();if(e[t]!=undefined)if(e[t].track_code!=undefined){console.log("Sucessful code");e[n].track_code=n;i.set(e[n])}else{console.log(e[t].error_code);i.save({error_code:e[t].error_code,detail_description:e[t].detail_description,short_description:e[t].short_description,spinner:""})}}})}}}});nzp.TabView=Backbone.View.extend({initialize:function(){_.bindAll(this,"render");this.tabtype=this.options.tabtype},render:function(){this.collection.each(function(e){var t=new nzp.SingleTabView({model:e,parentview:this.tabtype});this.$el.append(t.render().el)},this);return this}});nzp.SingleTabView=Backbone.View.extend({tagName:"li",events:{"click a":"clicked"},initialize:function(){_.bindAll(this,"render");this.model.bind("change:highlighted",this.highlight,this);this.render()},clicked:function(e){var t=this;e.preventDefault();if(this.options.parentview=="travelroute"){var n=this.model.get("slug").toUpperCase();nzp.calcRoute(n)}if(this.options.parentview==="allmarkers"){nzp.infoWindow.close();this.$el.hasClass("tab-current")||nzp.calcMarkers(this.model.get("title"))}this.model.collection.each(function(e){e==t.model?e.set("highlighted",!0):e.set("highlighted",!1)})},highlight:function(){this.model.get("highlighted")?this.$el.addClass("tab-current"):this.$el.removeClass("tab-current")},render:function(){var e=_.template("<a href='#' class='<% print(slug); %>'><span><% print(title); %></span></a>"),t=e({slug:"tab-"+this.model.toJSON().slug,title:this.model.toJSON().title});this.$el.html(t);return this}});nzp.MenuView=Backbone.View.extend({initialize:function(){_.bindAll(this,"render")},render:function(){_.each(this.model.attributes,function(e){var t=new nzp.NavItem({model:e});this.$el.append(t.render().el)},this);return this}});nzp.NavItem=Backbone.View.extend({tagName:"li",template:$("#navTemplate").html(),render:function(){var e=_.template(this.template);this.$el.html(e(this.model));this.delegateEvents();return this},events:{"click a":"clicked"},clicked:function(e){e.preventDefault();nzp.$loading.addClass("show");switch(this.model.slug){case"locator":nzp.router.navigate("locator",!0);break;case"ratefinder":nzp.router.navigate("ratefinder",!0);break;case"tracking":nzp.router.navigate("tracking",!0);break;case"contact":nzp.router.navigate("contact",!0);break;default:nzp.router.navigate("",!0)}nzp.$body.removeClass("active");nzp.$loading.removeClass("show")}});var RateFinderPageView=Backbone.View.extend({el:$("#pages"),initialize:function(){_.bindAll(this,"renderItem");this.render()},render:function(){var e="<p>Your bones don't break, mine do. That's clear. Your cells react to bacteria and viruses differently than mine. You don't get sick, I do. That's also clear. But for some reason, you and I react the exact same way to water. We swallow it too fast, we choke. We get some in our lungs, we drown. However unreal it may seem, we are connected, you and I. We're on the same curve, just on opposite ends.</p>";return this},renderItem:function(){}});nzp.HomePageView=Backbone.View.extend({tagName:"ul",className:"page home-items list list-arrows",initialize:function(){_.bindAll(this,"render")},render:function(){_.each(this.model.attributes,function(e){var t=new nzp.NavItem({model:e});this.$el.append(t.render().el);return this},this);return this},onClose:function(){this.model.unbind("change",this.render)}});nzp.MapPageView=Backbone.View.extend({initialize:function(){var e,t,n,r;_.bindAll(this,"render","directionsMap")},render:function(){typeof google=="undefined"?nzp.loadGoogleMap():nzp.initializeMap();nzp.testMapLoaded(this.directionsMap,this.model)},directionsMap:function(e){directionsDisplay=new google.maps.DirectionsRenderer;directionsService=new google.maps.DirectionsService;directionsDisplay.setMap(map);myLocation={lat:this.coords.latitude,lng:this.coords.longitude};var t=nzp.travel_mode||"driving";nzp.calcRoute(t.toUpperCase(),e,myLocation)}});nzp.calcRoute=function(e,t,n){nzp.headerTitle.set({title:e.toLowerCase()});existingTravelMode=e;if(t!==undefined){journeyStart=n.lat+","+n.lng;journeyEnd=t.getLatLng().toUrlValue()}var r={origin:journeyStart,destination:journeyEnd,travelMode:google.maps.TravelMode[e]};directionsService.route(r,function(e,t){t==google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(e)});nzp.router.navigate("locator/closest/"+nzp.current_place.id+"/"+e.toLowerCase(),{replace:!0})};var markers=[],ShowMapAllView=Backbone.View.extend({initialize:function(){_.bindAll(this,"render","allmarkers")},render:function(){typeof google=="undefined"?nzp.loadGoogleMap():nzp.initializeMap();myLocations={lat:this.collection.lat,lng:this.collection.lng};nzp.testMapLoaded(this.allmarkers,{lat:myLocations.lat,lng:myLocations.lng})},allmarkers:function(){nzp.infoWindow=new google.maps.InfoWindow;var e=new google.maps.LatLngBounds;this.collection.map(function(t){var n=t.toJSON(),r=t.getLatLng(),i=t.createMarker();i.setMap(map);e.extend(r);(function(e,t){google.maps.event.addListener(e,"click",function(n){nzp.infoWindow.setContent(t.infowindowContent());nzp.infoWindow.open(map,e)});markers.push(e)})(i,t)},this);map.fitBounds(e);var t=nzp.nearby_type||"All";nzp.calcMarkers(t);return this}});nzp.calcMarkers=function(e){$.each(markers,function(t,n){e.toLowerCase()===n.get("location_type").toLowerCase()||e==="All"?markers[t].setVisible(!0):markers[t].setVisible(!1)});nzp.headerTitle.set({title:e});nzp.router.navigate("locator/nearby/"+escape(e),{replace:!0})};nzp.LocatorDetailView=Backbone.View.extend({el:'<div id="locator-details-page" class="page">',initialize:function(){_.bindAll(this,"render");this.template=_.template($("#tmp-locator-detail").html());this.collection.bind("reset",this.render,this)},events:{"click .locator-map":"loadDetails"},render:function(){this.$el.append(this.template(this.collection.toJSON()));return this},loadDetails:function(e){e.preventDefault();var t=nzp.travel_mode||"driving";nzp.router.navigate("locator/closest/"+this.collection.id+"/"+t,{trigger:!0})}});