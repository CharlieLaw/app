/* Sample Tracking Codes
	UD190381395NZ
	EE748286200CN
	EP311788967NZ
	CQ023933725US
	EP501829835NZ
*/// Individual tracking item
nzp.TrackingItemView=Backbone.View.extend({el:"<li>",template:_.template($("#tmp-tracking-item").html()),events:{"click a":"showDetails"},initialize:function(){this.model.bind("change",this.render,this)},render:function(){var e=this.template(this.model.toJSON());this.$el.html(e);$("a",this.$el).addClass(this.model.get("highlight"));return this},showDetails:function(e){e.preventDefault();var t=this.model.toJSON().track_code;nzp.router.navigate("tracking/"+t,{trigger:!0})}});var TrackingPageView=Backbone.View.extend({template:_.template($("#tmp-tracking").html()),el:'<ul id="tracking-list" class="list list-arrows">',initialize:function(){nzp.trackingPageCollection.bind("add",this.addOne,this);nzp.trackingPageCollection.bind("reset",this.render,this)},render:function(e){this.addAll();$trackingItem=this.$("#tracking-items");$("#tracking-page").append(this.$el);return this},addOne:function(e){console.log("add one");var t=new nzp.TrackingItemView({model:e});this.$el.prepend(t.render().el)},addAll:function(){$(this.el).html("");nzp.trackingPageCollection.each(function(e){var t=new nzp.TrackingItemView({model:e});this.$el.append(t.render().el)},this)}});nzp.TrackingFormView=Backbone.View.extend({template:_.template($("#tmp-tracking").html()),initialize:function(){_.bindAll(this,"render")},events:{"click #tracking-submit":"getPackage","click #tracking-scan":"scanItem"},render:function(){this.$el.html(this.template({}));$trackingNo=this.$("#tracking-number");return this},getPackage:function(e){e.preventDefault();if($trackingNo.val()!=""){var t=$trackingNo.val();this.processTrackingCode(t)}},scanItem:function(e){e.preventDefault();var t=this;window.plugins.barcodeScanner.scan(function(e){e.cancelled||t.processTrackingCode(e.text)},function(e){alert("Scanning failed: "+e)})},processTrackingCode:function(e){$trackingNo.blur();var t;this.collection.each(function(n){if(n.get("track_code")===e){t=n;n.set("highlight","highlight high-out");setTimeout(function(){n.set("highlight","high-out")},1e3)}});if(!IsObject(t)){var n=nzp.trackingPageCollection.create({track_code:e});$.ajax({dataType:"jsonp",url:n.url(),success:function(t){var r=e.toUpperCase();if(t[r]!=undefined)if(t[r].track_code!=undefined){console.log("Sucessful code");t[e].track_code=e;n.set(t[e])}else n.save({error_code:t[r].error_code,detail_description:t[r].detail_description,short_description:t[r].short_description,spinner:""})}})}}});